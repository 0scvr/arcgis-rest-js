<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body>

<div class="container-fluid">
    <div class="jumbotron" >
        <h1>get to geocodin!</h1>
        <p>type things, click buttons and snoop in the <a href='https://developer.chrome.com/devtools'>developer console</a>.</p>
    </div>

    <div class="col-md-4">

    </div>
    <div class="col-md-4">
        <p>
            <button class="btn" id="metadata" role="button">get service info</button>
        </p>

        <p>
            <input id="geocodeInput" placeholder="123 main st"></input>
            <button class="btn" id="geocode" role="button">geocode an address</button>
        <p>
            <input id="suggestInput" placeholder="World Tr"></input>
            <button class="btn" id="suggest" role="button">get address suggestion</button>
        </p>

        <p>
            <input id="reverseInput" placeholder="-118,34"></input>
            <button class="btn" id="reverse" role="button">determine address</button>
        </p>

        <p>
            <a href="" class="btn" id="sign-in" role="button">Sign In</a><br>
        </p>

        <p>
            <button class="btn" id="bulk" role="button">geocode many addresses</button>
        </p>
    </div>
</div>

<script src="config.js"></script>
<script src="node_modules/@esri/rest-request/dist/umd/rest-request.umd.js"></script>
<script src="node_modules/@esri/rest-auth/dist/umd/rest-auth.umd.js"></script>
<script src="node_modules/@esri/rest-geocoder/dist/umd/rest-geocoder.umd.js"></script>

<script>
var auth;

// add back later for bulk geocoding
var authBtn = document.getElementById('sign-in');

authBtn.addEventListener('click', function (e) {
  EsriRestAuth.UserSession.beginOAuth2({
    clientId: ClientId,
    redirectUri: "http://localhost:8080/post-sign-in.html",
    popup: true,
    portal: "https://www.arcgis.com/sharing/rest"
  }).then((session) => {
    auth = session;
    console.log(session);
    document.getElementById('sign-in').innerHTML = 'you are signed in';
  }).catch(error => {
    console.log(error);
  });
  e.preventDefault();
});

var geocodeBtn = document.getElementById('geocode');

geocodeBtn.addEventListener('click', function (e) {
    EsriRestGeocoder.single(document.getElementById("geocodeInput").value)
    .then((response) => {
        console.log("simple", response);
    });
});

var suggestBtn = document.getElementById('suggest');

suggestBtn.addEventListener('click', function (e) {
  EsriRestGeocoder.suggest(document.getElementById("suggestInput").value)
    .then((response) => {
        console.log("suggest", response);
    });
});

var reverseBtn = document.getElementById('reverse');

reverseBtn.addEventListener('click', function (e) {
  // need to parse
  EsriRestGeocoder.reverse(document.getElementById("reverseInput").value.split(','))
    .then((response) => {
        console.log("reverse", response);
    });
});

var metadataBtn = document.getElementById('metadata');

metadataBtn.addEventListener('click', function (e) {
  EsriRestGeocoder.serviceInfo()
    .then((response) => {
        console.log("metadata", response);
    });
});

var bulkBtn = document.getElementById('bulk');

bulkBtn.addEventListener('click', function (e) {
    var addresses = [
        {
            "attributes": {
                "OBJECTID": 1,
                "SingleLine": "380 New York St. Redlands 92373"
            }
        },
        {
            "attributes": {
                "OBJECTID": 2,
                "SingleLine": "1 World Way Los Angeles 90045"
            }
        }
    ];
    EsriRestGeocoder.bulk(addresses, { authentication: auth })
    .then((response) => {
        console.log("bulk", response);
    })
    .catch((err) => {
        console.warn(err);
    });
});
</script>
</body>
</html>
